create target-based distribution by a2p customer
OBM API
POST to http://vm-obm-tst.dc/uaa/oauth/token | curl -v -X POST 'http://vm-obm-tst.dc/uaa/oauth/token' -H 'Authorization: Basic d2ViYXBwOndlYmFwcA==' -H 'Accept: */*' -H 'Content-Type: application/x-www-form-urlencoded; charset=ISO-8859-1' ; Params: grant_type = password; username = [your user name]; password = [your user password] | Status code 200
get access_token from previous step |  | access_token is present in response
POST to http://vm-obm-tst.dc/entity/api/xm-entities | curl -v -X POST 'http://vm-obm-tst.dc/entity/api/xm-entities' -H 'Accept: */*' -H 'Content-Type: application/json; charset=UTF-8' -d '{ "typeKey": "DISTRIBUTION.TARGETS-BASED", "data": { "targetQuery": "{\"size\":1000,\"query\":{\"bool\":{\"must\":[{\"bool\":{\"should\":[[{\"geo_distance\":{\"distance\":5000,\"homeLocation\":{\"lat\":50.4476917,\"lon\":30.52205730000003}}}],[{\"geo_distance\":{\"distance\":5000,\"workLocation\":{\"lat\":50.4476917,\"lon\":30.52205730000003}}}]]}}]}}}", "filters": { "geo": { "type": "array", "key": "geo", "name": { "uk": "Геопозиція", "en": "Geo Position", "ru": "Географическая позиция" }, "group": "geo", "groupPrice": 0.6, "filter": [ { "latitude": 50.4476917, "longitude": 30.52205730000003, "fillColor": "rgba(230, 0, 0, 0.3)", "marker": { "latitude": 50.4476917, "longitude": 30.52205730000003, "label": "1", "editable": true, "address": "Khreschatyk St, Kyiv, Ukraine, 02000" }, "circle": { "latitude": 50.4476917, "longitude": 30.52205730000003, "fillColor": "rgba(230, 0, 0, 0.3)", "editable": true, "radius": 5000, "circleDraggable": true } } ], "elasticFilter": { "bool": { "should": [ [ { "geo_distance": { "distance": 5000, "homeLocation": { "lat": 50.4476917, "lon": 30.52205730000003 } } } ], [ { "geo_distance": { "distance": 5000, "workLocation": { "lat": 50.4476917, "lon": 30.52205730000003 } } } ] ] } } } }, "charging": { }, "transportFlow": "SIMPLE", "transport": [ "SMS" ], "rateLimit": { "interval": "SECOND", "value": 1 }, "deliveryReportEnabled": true, "blackListEnabled": true, "notify": { "modes": { "beforeStart": null } }, "sender": { "name": "[your sender name]" }, "message": { "content": "[your distribution description]", "action": { } }, "messageTemplate": "autotest-ap_customer_1", "messageRef": "20039" }, "name": "[your distribtion name]", "stateKey": "DRAFT", "startDate": null, "updateDate": null, "endDate": null }' | Status code 201
check body from previous step |  | typeKey = DISTRIBUTION.TARGETS-BASED; stateKey = DRAFT; name = [your distribution name]; data.message.content = [your distribution description]; data.sender.name = [your sender name]

create target-based distribution by a2p manager
OBM API
POST to http://vm-obm-tst.dc/uaa/oauth/token | curl -v -X POST 'http://vm-obm-tst.dc/uaa/oauth/token' -H 'Authorization: Basic d2ViYXBwOndlYmFwcA==' -H 'Accept: */*' -H 'Content-Type: application/x-www-form-urlencoded; charset=ISO-8859-1' ; Params: grant_type = password; username = [your user name]; password = [your user password] | Status code 200
get access_token from previous step |  | access_token is present in response
POST to http://vm-obm-tst.dc/entity/api/xm-entities | curl -v -X POST 'http://vm-obm-tst.dc/entity/api/xm-entities' -H 'Accept: */*' -H 'Content-Type: application/json; charset=UTF-8' -d '{ "typeKey": "DISTRIBUTION.TARGETS-BASED", "data": { "targetQuery": "{\"size\":1000,\"query\":{\"bool\":{\"must\":[{\"bool\":{\"should\":[[{\"geo_distance\":{\"distance\":5000,\"homeLocation\":{\"lat\":50.4476917,\"lon\":30.52205730000003}}}],[{\"geo_distance\":{\"distance\":5000,\"workLocation\":{\"lat\":50.4476917,\"lon\":30.52205730000003}}}]]}}]}}}", "filters": { "geo": { "type": "array", "key": "geo", "name": { "uk": "Геопозиція", "en": "Geo Position", "ru": "Географическая позиция" }, "group": "geo", "groupPrice": 0.6, "filter": [ { "latitude": 50.4476917, "longitude": 30.52205730000003, "fillColor": "rgba(230, 0, 0, 0.3)", "marker": { "latitude": 50.4476917, "longitude": 30.52205730000003, "label": "1", "editable": true, "address": "Khreschatyk St, Kyiv, Ukraine, 02000" }, "circle": { "latitude": 50.4476917, "longitude": 30.52205730000003, "fillColor": "rgba(230, 0, 0, 0.3)", "editable": true, "radius": 5000, "circleDraggable": true } } ], "elasticFilter": { "bool": { "should": [ [ { "geo_distance": { "distance": 5000, "homeLocation": { "lat": 50.4476917, "lon": 30.52205730000003 } } } ], [ { "geo_distance": { "distance": 5000, "workLocation": { "lat": 50.4476917, "lon": 30.52205730000003 } } } ] ] } } } }, "charging": { }, "transportFlow": "SIMPLE", "transport": [ "SMS" ], "rateLimit": { "interval": "SECOND", "value": 1 }, "deliveryReportEnabled": true, "blackListEnabled": true, "notify": { "modes": { "beforeStart": null } }, "sender": { "name": "[your sender name]" }, "message": { "content": "[your distribution description]", "action": { } }, "messageTemplate": "autotest-ap_customer_1", "messageRef": "20039" }, "name": "[your distribtion name]", "stateKey": "DRAFT", "startDate": null, "updateDate": null, "endDate": null }' | Status code 201
check body from previous step |  | typeKey = DISTRIBUTION.TARGETS-BASED; stateKey = DRAFT; name = [your distribution name]; data.message.content = [your distribution description]; data.sender.name = [your sender name]

create target-based distribution by super admin
OBM API
POST to http://vm-obm-tst.dc/uaa/oauth/token | curl -v -X POST 'http://vm-obm-tst.dc/uaa/oauth/token' -H 'Authorization: Basic d2ViYXBwOndlYmFwcA==' -H 'Accept: */*' -H 'Content-Type: application/x-www-form-urlencoded; charset=ISO-8859-1' ; Params: grant_type = password; username = [your user name]; password = [your user password] | Status code 200
get access_token from previous step |  | access_token is present in response
POST to http://vm-obm-tst.dc/entity/api/xm-entities | curl -v -X POST 'http://vm-obm-tst.dc/entity/api/xm-entities' -H 'Accept: */*' -H 'Content-Type: application/json; charset=UTF-8' -d '{ "typeKey": "DISTRIBUTION.TARGETS-BASED", "data": { "targetQuery": "{\"size\":1000,\"query\":{\"bool\":{\"must\":[{\"bool\":{\"should\":[[{\"geo_distance\":{\"distance\":5000,\"homeLocation\":{\"lat\":50.4476917,\"lon\":30.52205730000003}}}],[{\"geo_distance\":{\"distance\":5000,\"workLocation\":{\"lat\":50.4476917,\"lon\":30.52205730000003}}}]]}}]}}}", "filters": { "geo": { "type": "array", "key": "geo", "name": { "uk": "Геопозиція", "en": "Geo Position", "ru": "Географическая позиция" }, "group": "geo", "groupPrice": 0.6, "filter": [ { "latitude": 50.4476917, "longitude": 30.52205730000003, "fillColor": "rgba(230, 0, 0, 0.3)", "marker": { "latitude": 50.4476917, "longitude": 30.52205730000003, "label": "1", "editable": true, "address": "Khreschatyk St, Kyiv, Ukraine, 02000" }, "circle": { "latitude": 50.4476917, "longitude": 30.52205730000003, "fillColor": "rgba(230, 0, 0, 0.3)", "editable": true, "radius": 5000, "circleDraggable": true } } ], "elasticFilter": { "bool": { "should": [ [ { "geo_distance": { "distance": 5000, "homeLocation": { "lat": 50.4476917, "lon": 30.52205730000003 } } } ], [ { "geo_distance": { "distance": 5000, "workLocation": { "lat": 50.4476917, "lon": 30.52205730000003 } } } ] ] } } } }, "charging": { }, "transportFlow": "SIMPLE", "transport": [ "SMS" ], "rateLimit": { "interval": "SECOND", "value": 1 }, "deliveryReportEnabled": true, "blackListEnabled": true, "notify": { "modes": { "beforeStart": null } }, "sender": { "name": "[your sender name]" }, "message": { "content": "[your distribution description]", "action": { } }, "messageTemplate": "autotest-ap_customer_1", "messageRef": "20039" }, "name": "[your distribtion name]", "stateKey": "DRAFT", "startDate": null, "updateDate": null, "endDate": null }' | Status code 201
check body from previous step |  | typeKey = DISTRIBUTION.TARGETS-BASED; stateKey = DRAFT; name = [your distribution name]; data.message.content = [your distribution description]; data.sender.name = [your sender name]
